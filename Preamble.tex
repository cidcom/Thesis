\documentclass[12pt, a4paper, oneside, english]{book}

% XeTeX!
% AMSSYMB needs to be declared before FONTSPEC & XUNICODE
\usepackage{amssymb}
% Set fonts
\usepackage{fontspec,xltxtra,xunicode}
\defaultfontfeatures{Mapping=tex-text}
\setromanfont[Mapping=tex-text]{Baskerville}
\setsansfont[Scale=MatchLowercase,Mapping=tex-text]{Gill Sans}
% \setsansfont[Scale=MatchLowercase,Mapping=tex-text]{Century Gothic}
\setmonofont[Scale=MatchLowercase]{Menlo}
\usepackage{sectsty}
% \chapterfont{\sffamily\mdseries}
% \sectionfont{\sffamily\mdseries}
\allsectionsfont{\sffamily\mdseries}

% Set Line spacing
\usepackage{setspace}
% \singlespacing
\onehalfspacing
% \doublespacing
% \setstretch{1.25}

% Set Margins
\usepackage[left=4cm, right=2.5cm, top=2cm, bottom=4cm]{geometry}

% Set paragraph indents to 1 cm
\setlength{\parindent}{0.5cm}

% Set no space between paragraphs
\setlength{\parskip}{0ex}

% No extra space between words
\frenchspacing

% Set up margin notes
% \usepackage{mparhack}
% \newcommand{\marginnote}[1]{\marginpar{\vspace{-8ex}\singlespacing\raggedright\scriptsize{#1}}}

% Reduce the size of footnote text
\usepackage{footmisc}
\renewcommand*{\footnotelayout}{\scriptsize\rmfamily}

% Set page numbers
% NB: fancyhdr *has* to load after the geometry package!)
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[RE,RO]{\textsf\thepage}

% This set page numbers for pages at the start of chapters (Not sure exactly why this is needed!)
\fancypagestyle{plain}{%
     \fancyfoot[RE,RO]{\textsf\thepage}}

% Force width of header rule to zero
\renewcommand{\headrulewidth}{0pt}
% \renewcommand{\footrulewidth}{0pt}

% Prevent over-eager hyphenation
% \hyphenpenalty=5000
\tolerance=1000

% % Set up block quotes
% \let\oldquote\quote
% \renewcommand\quote{\par\RaggedRight\singlespacing\small\oldquote}

% Captions left justified
\usepackage[format=plain,labelsep=newline,singlelinecheck=false,font={small},labelfont={small,bf}]{caption}[2008/04/01]

% Control the fonts and formatting used in the table of contents.
\usepackage[titles, subfigure]{tocloft}
% Change the spacing before TOC entries.
\setlength{\cftbeforechapskip}{2ex}
% \setlength{\cftbeforesecskip}{1ex}
% \setlength{\cftbeforesubsecskip}{1ex}
% Increase the size of chapter entries
\renewcommand{\cftchapfont}{\normalfont\sffamily\Large}
% Decrease the size of section entries
\renewcommand{\cftsecfont}{\normalfont\rmfamily\small}
% Decrease the size of subsection entries
\renewcommand{\cftsubsecfont}{\normalfont\rmfamily\small}

% Pretty tables
\usepackage{mdwtab}

% Long tables
\usepackage{longtable, mdwtab}

\usepackage{longtable}
% Don't indent longtables by a parindent!
\setlength\LTleft{0pt}
\setlength\LTright{0pt}

% Multirow cells in tables
\usepackage{multirow}

% Dummy text
\usepackage{babel}
\usepackage{blindtext}

% List of publications page
\usepackage{multibib}
\newcites{MyPublications}{List of Publications}

% Maths
\usepackage[fleqn]{amsmath} % All equations left justified
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{stmaryrd}
\allowdisplaybreaks
\usepackage{latexsym}
\usepackage{bm}
\usepackage{dsfont}
\usepackage{mathrsfs}
\usepackage{xfrac} %  \sfrac
\DeclareMathOperator\erf{erf}
%% Examples, assumptions, definitions
\theoremstyle{definition}
\newtheorem{problem}{Problem}
\newtheorem{assumptions}{Assumptions}[chapter]
\newtheorem{define}{Definition}[chapter]
%% Theorems
\theoremstyle{thm}
\newtheorem*{thm}{Theorem}
%% Numbered propositions, colloraries, conjectures
\theoremstyle{plain}
\newtheorem{proposition}{Proposition}[chapter]
\newtheorem{corollary}[proposition]{Corollary}
\newtheorem{conjecture}[proposition]{Conjecture}
%% Custom-numbered, appendix-inserted propositions
\newtheoremstyle{styleAppendix}%
{}%
{}%
{\itshape}%
{}%
{\bfseries}%
{.}%
{ }%%
{\thmname{#1}\thmnote{ #3}}%
\theoremstyle{styleAppendix}
\newtheorem*{propositiona}{Proposition}
%% QED symbol
\renewcommand{\qedsymbol}{$\blacksquare$}
%% Custom operators
\DeclareMathOperator*{\argmax}{arg\,max}

% Algorithms
\usepackage[chapter]{algorithm}
\usepackage[noend]{algpseudocode}
\newcommand*\Let[2]{\State #1 $\gets$ #2}
\algrenewcommand\alglinenumber[1]{%
  {\sf\footnotesize\addfontfeatures{Colour=888888}#1}%
}
\algrenewcommand\algorithmicrequire{\textbf{Input:}}
\algrenewcommand\algorithmicensure{\textbf{Output:}}
\makeatletter
\newcommand{\StatexIndent}[1][3]{%
  \setlength\@tempdima{\algorithmicindent}%
  \Statex\hskip\dimexpr#1\@tempdima\relax%
}
\makeatother

% Subfigures
% \usepackage{subfig}
\usepackage{subcaption}

% URLs
\usepackage{url}

% Compact lists
\newenvironment{itemize*}%
  {\begin{itemize}%
    \setlength{\itemsep}{0.5pt}%
    \setlength{\parskip}{0.5pt}}%
  {\end{itemize}}

\newenvironment{enumerate*}%
  {\begin{enumerate}%
    \setlength{\itemsep}{0.5pt}%
    \setlength{\parskip}{0.5pt}}%
  {\end{enumerate}}

% Set figure size
\newcommand{\figsize}{4.5in}

% Source code listings
\usepackage{listings}
\lstset{
  language=Python,
  numbers=left,
  numbersep=5pt,
  numberstyle=\tiny,
  tabsize=2,
  frame=single,
  showstringspaces=false,
  formfeed=\newpage,
  tabsize=4,
  commentstyle=\itshape,
  basicstyle=\ttfamily,
  morekeywords={lambda, True, False}
}

% Numbered subsubsections
\setcounter{secnumdepth}{3}

% Annotate correction
\usepackage{color}
\newcommand{\annotate}[2]{\marginpar{{\color{red}\textbf{#1}}}{\color{red}\emph{#2}}}
